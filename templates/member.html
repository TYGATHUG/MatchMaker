{% extends 'main.html' %}

{% block body %}
    <!-- Display Validation errors-->
    {% with messages=get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                <script>
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": true,
                        "progressBar": true,
                        "positionClass": "toast-top-center",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "2000",
                        "hideDuration": "2000",
                        "timeOut": "2500",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut",
                        "closeMethod": "fadeOut"
                    }
                    toastr["success"]("Welcome {{ name }} !", "{{ message }}")
                </script>
            {% endfor %}
        {% endif %}
    {% endwith %}
    <!-- End Display Validation errors-->

    <!-- If user has not set up a match profile -->
    {% if curr_user_table.setup == False %}
        <section id="intro" class="section intro no-padding">
            <div class="container-fluid"
                 style="background: linear-gradient(rgba(255, 0, 0, 0.45),rgba(255, 0, 0, 0.45)),url(../static/images/other/Elegant_Background-7.jpg)">
                <blockquote class="site-info" style="height: 640px !important;">
                    <h2 style="text-align: center">Welcome aboard the love train !</h2>
                    <h1>Please set up your profile to begin.</h1>

                    <form action="/profile">
                        <div class="form-single-input">
                            <div class="form-group col_1_of_1" style="margin-bottom: 100px;">
                                <button type="submit" class="btn btn-default" style="letter-spacing: 1px;">Setup
                                    Profile
                                </button>
                            </div>
                        </div>
                    </form>

                </blockquote>
            </div>
        </section>

    <!-- If is has setup a profile display match profiles -->
    {% else %}
        <section id="intro" class="section intro no-padding">
            <div class="container-fluid"
                 style="background: linear-gradient(rgba(51,70,92,0.91),rgba(51,70,92,0.91)),url(../static/images/other/Elegant_Background-7.jpg)">
                <blockquote class="site-info">
                    <h1></h1>
                    <div class="tab">
                        <button class="tablinks" onclick="openCity(event, 'match')" id="defaultOpen">Recommend</button>
                        <button class="tablinks" onclick="openCity(event, 'chat')">Matched</button>
                        <button class="tablinks" onclick="openCity(event, 'setting')" style="border-right: none">
                            Settings
                        </button>
                    </div>

                    <div id="match" class="tabcontent" style="overflow: hidden;">
                        <div class="match-user">

                            {% for user in highest_match_users %}
                                {% for value in user %}

                                    {% if value.username %}
                                       <span class="matched_username" style="display:none;">{{ value.username }}</span>
                                    {% endif %}

                                    {% if value.image %}
                                        <img class="mySlides w3-animate-left" src="../static/images/profiles/{{ value.image }}" style="width:100%;">
                                    {% endif %}

                                {% endfor %}
                            {% endfor %}
                            <div class="like-dislike-btn">
                                <button id="dislike" class="w3-button w3-blue" onclick="plusDivs(-1)" name="dislike" value="dislike">DISLIKE</button>
                                <button id="like" class="w3-button w3-pink" onclick="plusDivs(1)" name="like" value="like">LIKE</button>
                            </div>

                        <button class="accordion">Show Info</button>
                        <div class="panel">

                            <p><b>Name: </b><span id="panel-name">Something</span></p>
                            <p><b>Gender: </b><span id="panel-gender">Something</span></p>
                            <p><b>Age: </b><span id="panel-age">Something</span></p>
                            <p><b>Height: </b><span id="panel-height">Something</span></p>
                            <p><b>Location: </b><span id="panel-location">Something</span></p>
                            <p><b>Education: </b><span id="panel-education">Something</span></p>
                            <p><b>Bio:</b><span id="panel-bio">Something</span></p>
                        </div>
                    </div>

                        <script>  <!-- Javascript for Image slider -->

                            // Image section
                            var slideIndex = 1;
                            showDivs(slideIndex);
                            function plusDivs(n) {
                                showDivs(slideIndex += n);
                            }

                            function showDivs(n) {
                                var i;
                                var x = document.getElementsByClassName("mySlides");
                                if (n > x.length) {
                                    slideIndex = 1
                                }
                                if (n < 1) {
                                    slideIndex = x.length
                                }
                                for (i = 0; i < x.length; i++) {
                                    x[i].style.display = "none";
                                }
                                console.log(slideIndex-1)
                                x[slideIndex - 1].style.display = "block";
                            }

                            // POST likes / dislikes here

                            var matched_username = document.getElementsByClassName("matched_username");
                            matched_username = (matched_username[slideIndex -1 ].textContent);
                            $('#like').click(function() {
                                var likeIndex = slideIndex;

                                if ( likeIndex-2 == -1) {
                                    console.log('yep')
                                    likeIndex = 7;
                                };

                                var like = document.getElementById('like').value;
                                var matched_username = document.getElementsByClassName("matched_username");
                                matched_username = (matched_username[likeIndex - 2].textContent);
                                console.log(matched_username)

                                    $.ajax({
                                        type: 'POST',
                                        url: '/member',
                                        data: {
                                            like_dislike: like,
                                            liked_user: matched_username
                                    },
                                    success: function(response) {
                                        console.log('success');
                                    }
                                });
                            });
                            likeIndex  = 1

                            // Accordian
                            var acc = document.getElementsByClassName("accordion");
                            var i;
                            for (i = 0; i < acc.length; i++) {
                                acc[i].onclick = function () {
                                    this.classList.toggle("active");
                                    var panel = this.nextElementSibling;
                                    if (panel.style.maxHeight) {
                                        document.getElementsByClassName("accordion")[0].innerHTML = "SHOW INFO";
                                        panel.style.maxHeight = null;
                                    } else {
                                        document.getElementsByClassName("accordion")[0].innerHTML = "HIDE INFO";
                                        document.getElementById('panel-name');
                                        document.getElementById('panel-gender');
                                        document.getElementById('panel-age');
                                        document.getElementById('panel-height');
                                        document.getElementById('panel-location');
                                        document.getElementById('panel-education');
                                        document.getElementById('panel-bio');
                                        panel.style.maxHeight = panel.scrollHeight + "px";
                                    }
                                }
                            }

                        </script> <!-- Javascript for Image slider -->

                    <div id="chat" class="tabcontent">
                        <img src="../static/images/other/chat_demo.png" width="100%">
                        <p><b>Need to figure out the format of chats with multiple users...</b></p>
                    </div>

                    <div id="setting" class="tabcontent">
                        <img src="../static/images/other/settings_demo.jpg" width="100%">
                        <p><b>Quick setting toggles will go here (Age/Gender Preference)</b></p>
                    </div>

                    <script>
                        // Content Area
                        function openCity(evt, pageName) {
                            var i, tabcontent, tablinks;
                            tabcontent = document.getElementsByClassName("tabcontent");
                            for (i = 0; i < tabcontent.length; i++) {
                                tabcontent[i].style.display = "none";
                            }
                            tablinks = document.getElementsByClassName("tablinks");
                            for (i = 0; i < tablinks.length; i++) {
                                tablinks[i].className = tablinks[i].className.replace(" active", "");
                            }
                            document.getElementById(pageName).style.display = "block";
                            evt.currentTarget.className += " active";
                        }
                        // Get the element with id="defaultOpen" and click on it
                        document.getElementById("defaultOpen").click();
                    </script>

                </blockquote>
            </div>
        </section>
    {% endif %}

{% endblock %}
